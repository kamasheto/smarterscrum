#{extends 'magicBox.html' /}
#{set 'title'}${title}
#{/set}

#{if x==1}
   #{if user!=null}
	   #{list items:user.projects ,as :'project'}
		    <div class="reload-roles" name="/users/listUserProjects?userId=${user.id}&x=2&projectId=${project.id}&currentProjectId=${currentProject.id}">${project.name}</div>
	   #{/list}
   #{/if}
#{/if}

#{if x==2}
   #{if user!=null}
    #{list items:project.roles ,as :'pRole'}
     #{list items:user.roles ,as :'uRole'}
      #{if pRole.id == uRole.id}
      
      <div class="bar">${uRole.name}
      
       #{if connected.in(project).can('revokeUserRole')}
	      #{if project.id == currentProject.id}
	        <a onclick="revokeRole(${uRole.id}, ${uRole.baseRole});">
	        <img title="Revoke Role" src="@{'/public/images/famfam/group_delete.png'}">
	        </a>
	      #{/if}
	    #{/if}
	    
	    
	    #{elseif uRole.users.contains(connected)}
	      #{if !uRole.baseRole}
	        <a onclick="revokeRole(${uRole.id}, ${uRole.baseRole});">
	        <img title="Revoke Role" src="@{'/public/images/famfam/group_delete.png'}">
	        </a>
	      #{/if}
	    #{/elseif}
	      
	   </div>
	   
      #{/if}
     #{/list}
    #{/list}
   #{/if}
#{/if}