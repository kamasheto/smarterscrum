#{extends 'sidebar.html' /}

<ul id="notifications"></ul>

<a href="#"  style="display:inline-block" class="Notificationp" onclick="previousNotificationPage();"><span style="display:inline-block"class="ui-icon ui-icon-circle-arrow-w"></span></a>
<a href="#"  style="display:inline-block" class="Notificationn" onclick="nextNotificationPage();"><span style="display:inline-block"class="ui-icon ui-icon-circle-arrow-e"></span></a>

<div  style=" position: absolute; bottom: 0;"><b><font size="2">#{if emailing}<img src="/public/images/famfam/stop.png" /> <a id = "modify_emailing" onclick="modify_emailing(0);">Stop receiving Emails?</a>#{/if}
#{else}<img src="/public/images/famfam/forward.png" /> <a id = "modify_emailing" onclick="modify_emailing(1);">Enable receiving Emails?</a>#{/else}</font></b></div>

<script type="text/javascript">


function modify_emailing(i)
{
	var currentText = document.getElementById("modify_emailing").text;
	if(i==0)
		var res = confirm('Are you sure you want to stop receiving emails?');
	else
		var res = confirm('Are you sure you want to enable receiving emails?');
	if(res==true)
		$.post("@{Application.modifyEmailing}", {enable:i}, function(){
				$('#sideNoti').load('/Application/showNotifications');
			});
}
	search_notifications(0);
	function search_notifications(page) {
		$('#loading_img').show()
		$.post('/application/listNotifications', {page: page}, function(response){
			body = $('#notifications')
			body.empty()
			$('#loading_img').hide()
			$(response.logs).each(function() {
				body.append('<li id="log_'+this.id+'" class="log_item"><a onclick="show_log_content('+this.id+')">'+this.message+'</a><div></div></li>')
			})
			$('#notifications_pages').remove()
			body.after('<div id="notifications_pages" class="page_numbers _14">')
			div = $('#notifications_pages')
			if (response.currentPage != 1) {
				div.append('<a onclick="search_notifications('+(page-1)+')">Previous</a> ')
			}
			if (response.currentPage <= response.totalPages) div.append(response.currentPage + ' / ' + response.totalPages + ' ')
			if (response.currentPage != response.totalPages && response.totalPages) {
				div.append('<a onclick="search_notifications('+(page+1)+')">Next</a>')
			}
		})
	}
</script>