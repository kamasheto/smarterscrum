#{extends 'overlay.html' /} #{set title:'Sprint Backlog' /} 
#{ifnot tasks}
<div id="NOTE"style="padding: 10px 10px 10px 10px" class="ui-state-highlight ui-corner-all"> 
	<span style="float: left; margin-right: 0.3em;" class="ui-icon ui-icon-info"></span>
	<strong>NOTE: </strong>There isn't enough data to display</div>
#{/ifnot}
#{else}
#{set 'moreStyles'}
<style type="text/css">
thead
{
cursor:move;
}
</style>
#{/set}
#{set 'moreScripts'}
<script language="javascript" type="text/javascript"src="@{'/public/javascripts/jeditable-mod.js'}"></script>
<script  type="text/javascript" src="@{'/public/javascripts/dragtablenorm.js/'}" ></script>
<script  type="text/javascript" src="@{'/public/javascripts/sorttable.js/'}" ></script>
<script type="text/javascript">
function hideOrShow(c)
{
	$('.'+c).toggle();
}
#{ifnot connected.in(project).can('editBacklog') || connected.isAdmin}
function popUp(URL) 
{
	day = new Date();
	id = day.getTime();
	eval("page" + id + " = window.open(URL, '" + id + "', 'toolbar=0,scrollbars=1,location=0,statusbar=0,menubar=0,resizable=1,width=200,height=400,left = 583,top = 184');");
}
$(function() 
{	
	$(".enterEffort").each(function()
	{
		if($(this).html()!='')
			$(this).html(parseInt($(this).html()));
	});

	$(".editPOINTS").each(function()
	{
		if($(this).html()!='')
			$(this).html(parseInt($(this).html()));
	});

    $('.enterEffort').editable(
    function(value)
    {
        var theId 		= $('#lolid').closest("td").attr("id");
        var splitted 	= theId.split("_");
        var taskId 		= parseInt(splitted[1]);
        var dayId 		= parseInt(splitted[2])-1;
        var max			= parseInt(splitted[3]);
        var original	= parseInt(splitted[4]);
    	var points 		= parseInt(value);
    	if(points>max)
    	{
    		alert('Please enter a number between 0 & '+max);
    		return(original);
    	}
    	else if(isNaN(points))
    	{
    		alert('Please enter a number!');
    		return(original);
    	}
    	else
    	{	
    		$.post('@{Tasks.enterEffort()}',
    				{id:taskId,effort:points,day:dayId});     
        	
        	return(value);
    	}      
    },
    {    
        indicator : 'Saving...',
    });

    $('.editDES').editable(
    	    function(value)
    	    {
    	        var taskId 	= parseInt($('#lolid').closest("td").attr("id"));
    	       
    	        $.post('@{Tasks.editTaskDesc()}',
    	            {id:taskId, desc:value});

        	    return(value);
    	        
    	    },
    	    {    
    	        indicator : 'Saving...',
    	       
    	    });
    
    
    $('.editPOINTS').editable(
    	    function(value)
    	    {
    	        var theId 		= $('#lolid').closest("td").attr("id");
    	        var splitted 	= theId.split("_");
    	        var taskId 		= parseInt(splitted[0]);
    	        var original	= parseInt(splitted[1]);
    	    	var points 		= parseInt(value);
    	        
    	    	if(isNaN(points))
    	    	{
    	    		alert('Please enter a number!');
    	    		return(original);
    	    	}
    	    	else
    	    	{	
    	    		$.post('@{Tasks.editTaskEstimation()}',
    	    				{id:taskId,estimation:points});
    	    		$('#lolid').closest("td").attr("id",taskId+"_"+points);
    	    		$("td[id^=EF_"+taskId+"_]").each(function()
    	    	    		{
    	    	        		var theId 		= $(this).attr("id");
    	    	        		var splitted 	= theId.split("_");
    	    	       			var taskId 		= parseInt(splitted[1]);
    	    	        		var dayId 		= parseInt(splitted[2])-1;
    	    	        		var max			= parseInt(splitted[3]);
    	    	        		var original	= parseInt(splitted[4]);
	    	    				$(this).attr("id","EF_"+taskId+"_"+dayId+"_"+points+"_"+original);
	    	    			}
	    			);

    	        	return(value);  
    	    	}      
    	    },
    	    {    
    	        indicator : 'Saving...',
    	       
    	    });

});
#{/ifnot}
</script>

#{/set}
<div id="sprint">
<h1 style="float:left">#{if componentID==0}Sprint ${sNum}: ${project.name}'s Backlog#{/if}#{else}Sprint ${sNum}: ${cs}'s Backlog#{/else}</h1>
<div style="float:right;width:200px;">
<div class="allCornersRounded" style="background:#333;padding:15px;border-width:10px 10px 0;color:#eee">	
Show/Hide:

		<select id="hideshow"name="list">
        	<option onclick="hideOrShow('shDes');">Description</option> 
        	<option onclick="hideOrShow('shReviewer');">Reviewer</option> 
        	<option onclick="hideOrShow('shAssignee');">Assignee</option> 
        	<option onclick="hideOrShow('shType');">Type</option> 
        	<option onclick="hideOrShow('shStatus');">Status</option> 
        	<option onclick="hideOrShow('shPoints');">Points</option> 
        	<option onclick="hideOrShow('shEfforts');">Efforts</option> 
		</select>

</div>
<div class="notchBottom" style="border-top-color:#333"></div>
</div>
<br style="clear:both"/>
<table id="sprintTable" class="draggable sortable">
	<thead>
	<tr>
		<td>ID</td>
		<td class="shDes">Description</td>
		<td class="shType">Type</td>
		<td class="shStatus">Status</td>
		<td class="shAssignee">Assignee</td>
		<td class="shReviewer">Reviewer</td>
		<td class="shPoints">Total Points</td>
		#{list items:daysHeader, as:'day'}
		<td class="shEfforts">Day ${day}</td>
		#{/list}
	</tr>
	</thead>
	#{list items:tasks, as:'task'}
	<tr id="task_${task.id}">
	
		<td>
			<a title="view the task reports?" href="@{Tasks.getReport(task.id)}">${task.id}</a>
		</td>
		#{ifnot connected.id==task.assignee.id || flag}

          #{ifnot task.description}
          <td class="shDes">No Description stated</td>
          #{/ifnot}
          #{else}
		<td class="shDes">${task.description}</td>
          #{/else}
          
          #{ifnot task.taskType}
          <td class="shType">No Type stated</td>
          #{/ifnot}
          #{else}
          <td class="shType">${task.taskType.name}</td>
          #{/else}
          
           #{ifnot task.taskStatus}
          <td class="shStatus">No Status stated</td>
          #{/ifnot}
          #{else}
          <td class="shStatus">${task.taskStatus.name}</td>
          #{/else}
        
          #{ifnot task.assignee}
          <td class="shAssignee">No assignee stated</td>
          #{/ifnot}
          #{else}
          <td class="shAssignee">${task.assignee.name}</td>
          #{/else}
        
         #{ifnot task.reviewer}
          <td class="shReviewer">No reviewer stated</td>
          #{/ifnot}
          #{else}
          <td class="shReviewer">${task.reviewer.name}</td>
          #{/else}
        
         #{ifnot task.estimationPoints}
          <td class="shPoints">&nbsp;</td>
          #{/ifnot}
          #{else}
          <td class="shPoints">${task.estimationPoints}</td>
          #{/else}
        
        <!--@author Hadeer Younis C4 S8-->
        #{list items:daysHeader, as:'day'}
		<td class="shEfforts"style="text-align: center" id="${day}_${task.id}_${task.estimationPoints}" >
		#{if task.getEffortPerDay(day-1)==-1.0}&nbsp;
		#{/if} #{else} ${task.getEffortPerDay(day-1)} #{/else}</td>
		#{/list}
	
        
        #{/ifnot}
      
            
      
        #{else}
		#{ifnot task.description}
		<td class="shDes"><span id="${task.id}" class="editDES">No description stated
		</span></td>
		#{/ifnot} #{else}
		<td class="editDES shDes" title="edit the description?" id="${task.id}">${task.description}</td>
		#{/else} 
		
		#{ifnot task.taskType}
		<td id="${task.id}" class="editTYPE shType">
		#{if connected.in(project).can('changeTaskType')}
		<a title="Enter a task type??"HREF="javascript:popUp('@{Tasks.chooseTaskType(task.id)}')">No type chosen</a>
	    #{/if}
		No type chosen
		</td>
		#{/ifnot} 
		#{else}
		<td id="${task.id}" title="edit the task type?" class="editTYPE shType">
		#{if connected.in(project).can('changeTaskType')}
		<a title="Enter a task type??"HREF="javascript:popUp('@{Tasks.chooseTaskType(task.id)}')">${task.taskType.name}</a>
		#{/if}
</td>
		#{/else} 
		
		#{ifnot task.taskStatus}
		<td id="${task.id}" class="editStatus shStatus">
		<a title="Add the task Status??"HREF="javascript:popUp('@{Tasks.chooseTaskStatus(task.id)}')">No status chosen</a>
		No status chosen
		</td>
		#{/ifnot}
		 #{else}
		<td id="${task.id}" title="edit the task type?" class="editStatus shStatus">
		<a title="edit the task status??"HREF="javascript:popUp('@{Tasks.chooseTaskStatus(task.id)}')">
		${task.taskStatus.name}</a></td>
		#{/else}
		
		 #{ifnot task.assignee}
		<td id="${task.id}_assigneee" class="editASSI shAssignee"><a title="Choose an assignee?"HREF="javascript:popUp('@{Tasks.chooseTaskAssiRev(task.id,0)}')">
		
		Choose assignee</a></td>
		#{/ifnot}
		 #{else}
		<td id="${task.id}_assigneee" class="editASSI shAssignee"><a  title="change assignee?" HREF="javascript:popUp('@{Tasks.chooseTaskAssiRev(task.id,0)}')">
		${task.assignee.name}</a>
		
		</td>
		#{/else} 
		
		#{ifnot task.reviewer}
		<td id="${task.id}" class="editREV shReviewer"><a title="Add a reviewer?"HREF="javascript:popUp('@{Tasks.chooseTaskAssiRev(task.id,1)}')">
		No reviewer chosen</a>
		</td>
		#{/ifnot} 
		#{else}
		<td id="${task.id}" title="Change the reviewer?" class="editREV shReviewer"><a HREF="javascript:popUp('@{Tasks.chooseTaskAssiRev(task.id,1)}')">
		${task.reviewer.name}</a>
		</td>
		#{/else} 
		
		#{ifnot task.estimationPoints}
		<td id="${task.id}" class="editPOINTS shPoints">No points 
		</td>
		#{/ifnot}
		 #{else}
		<td id="${task.id}_${task.estimationPoints}" title="edit the estimationpoints?"
			class="editPOINTS shPoints" style="text-align: center">${task.estimationPoints}</td>
		#{/else}

		<!--@author Hadeer Younis C4 S8-->
		#{list items:daysHeader, as:'day'}
		<td style="text-align: center"id="EF_${task.id}_${day}_${task.estimationPoints}_${task.getEffortPerDay(day-1)}" class="enterEffort shEfforts">
		#{if task.getEffortPerDay(day-1)==-1.0}$nbsp;
		#{/if} #{else} ${task.getEffortPerDay(day-1)} #{/else}</td>
		#{/list}
		#{/else}
	</tr>

	#{/list}
</table>
</div>
#{/else}