#{extends 'main.html' /}
#{set title:'DeletionRequestRespond' /}

#{if requests.isEmpty()}
<br/>
<b><font color = "red">There are No New Deletion Requests in this project</font></b>
<br/> 
#{/if}

#{else}
<ul id= "prequests">
#{list items:requests, as:'req'}
	<li id="req_${req.id}"><a href="/show/user?id=${req.user.id}">${req.user.name}</a> has  requested to be deleted from the project.
	<a onclick="request_accept(${req.id}, '${req.hash}');" href="#">Accept  </a> &bull; 
	<a onclick="request_ignore(${req.id}, '${req.hash}');" href="#">Decline  </a>
	<a onclick="show_comment(${req.id});" href = "#">Decline2</a>
	<div id = "comment_${req.id}" style="display:none">
		<b>Dear ${req.user.name}, your request to be deleted from ${req.project.name} has been denied because ....</b>
		<textarea id = "text_${req.id}" rows="2" cols="150"></textarea><br />
		<a onclick="do_ignore(${req.id}, '${req.hash}');" href = "#"><font color="red"><b><u>Decline Request and Notify user</u></b></font></a>
		<br /> <br />
	</div>
	</li>
	

#{/list}
#{/else}
</ul>
<br/>
<a href="/show/project?id=${id}">Back to Project</a>
<script type="text/javascript">

function request_accept( id, hash )
{
	$.post('@{deletionRequestAccept()}' ,
		    {hash:hash} ,
		    function(){
		    $('#req_'+id).remove();
		    })
		}
function request_ignore( id, hash)
{
	$.post('@{requestIgnore()}' ,
		    {hash:hash} ,
		    function(){
		    $('#req_'+id).remove();
		    })
		}
function show_comment(id){
	
	$('#comment_'+id).show();
	}

function do_ignore(id, hash){
	var textValue = $('#text_'+id).val();
	if(textValue == '')
	alert('you must Enter a reason why you declined this request!');
	else
	{
		$.post('@{requestIgnore()}' ,
		    {hash:hash, body:textValue} ,
		    function(){
		    $('#req_'+id).remove();
		    })
			$('#comment_'+id).remove();
		}
	}

</script>